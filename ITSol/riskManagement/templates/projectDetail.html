<!DOCTYPE html>
<html>
    <head>
        {% include 'head.html' %}
    </head>
    <body>
        {% include 'nav.html' %}
            <a class="button" href="statistics/{{ projectId }}">Zobrazit statistiky</a>
        <h2>Stav projektu: {{ project.state }}</h2>

        <!-- Admin and project manager can change state of the project -->
        {% if is_user_authorized and is_editable %}
            <form action="changeProjectState/{{ projectId }}" method="post" style="margin-left: 20px;">
                {% csrf_token %}
                <div style="display: flex;">
                    <div>
                        <select name="state">
                            <option value="" disabled selected>Vyberte nov√Ω stav projektu</option>
                            <option>New</option>
                            <option>In progress</option>
                            <option>Closed</option>
                            <option>Canceled</option>
                        </select>
                    </div>
                    <div>
                        <input type="submit" value="Zmenit stav">
                    </div>
                </div>
            </form>
        {% endif %}

        <h2>U≈æivatel√© zapojen√≠ do projektu {{ project.name }}</h2>
        <input type="text" id="myInput" onkeyup="lookUp()"
        placeholder="Search in this table">
        <table id=userProjectTable>
            <tr>
                <th>ID</th>
                <th>Jm√©no</th>
                <th>Opr√°vnƒõn√≠</th>
                {% if is_user_authorized and is_editable %}
                    <th></th>
                    <th></th>
                {% endif %}
            </tr>
            {% for x in users %}
                <tr>
                    <th>{{ x.id }}</th>
                    <td>{{ x.firstName }} {{ x.lastName }}</td>
                    <td>{{ x.privileges }}</td>
                    {% if is_user_authorized and is_editable %}
                        <td class="center"><a href="removeUserFromProject/{{ x.id }}/{{ projectId }}">‚ùå</a></td>
                        <td class="center" style="width: 150px;"><a href="addUserToPhase/{{ x.id }}/{{ projectId }}">‚ûï (p≈ôidat f√°zy)</a></td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>

        {% if is_user_authorized and is_editable %}
            <form action="addUserToProject/{{ projectId }}" method="post" style="margin-left: 20px;">
                {% csrf_token %}
                <div style="display: flex;">
                    <div>
                        <input type="text" name="login" placeholder="login">
                    </div>
                    <div>
                        <input type="submit" value="P≈ôidat ƒçlena">
                    </div>
                </div>
            </form>
        {% endif %}

        <h2>F√°ze projektu {{ project.name }}</h2>
        <input type="text" id="myInput2" onkeyup="lookUp2()"
        placeholder="Search in phase table">
        <table id="phaseTable">
            <tr>
                <th>ID</th>
                <th>N√°zev</th>
                <th>Popis</th>
                <th>Poƒçet rizik</th>
                <th>Poƒçet pracovn√≠k≈Ø</th>
                <th></th>
                {% if is_user_authorized and is_editable %}
                    <th></th>
                    <th></th>
                {% endif %}
            </tr>
            {% for x, y in phases %}
                <tr>
                    <th>{{ x.id }}</th>
                    <td>{{ x.name }}</td>
                    <td>{{ x.description }}</td>
                    <td>{{ y }}</td>
                    <td>{{ x.participants.all.count }}</td>
                    <td class="center"><a href="phaseDetail/{{ projectId }}/{{ x.id }}">üîé</a></td>
                    {% if is_user_authorized and is_editable %}
                        <td class="center"><a href="editPhase/{{ x.id }}/{{ projectId }}">‚úèÔ∏è</a></td>
                        <td class="center"><a href="removePhase/{{ x.id }}/{{projectId }}">üóëÔ∏è</a></td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>

        {% if is_user_authorized and is_editable %}
            <a class="button" href="addPhase/{{projectId}}">P≈ôidat f√°zi</a>
        {% endif %}

    </body>
</html>
<script>
function lookUp() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("userProjectTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td");
    for (j = 0; j < td.length; j++) {
      txtValue = tr[i].getElementsByTagName("td")[j].textContent || tr[i].getElementsByTagName("td")[j].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
        break;
      } else {
        tr[i].style.display = "none";
      }
    }

  }
}
function lookUp2() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("myInput2");
  filter = input.value.toUpperCase();
  table = document.getElementById("phaseTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td");
    for (j = 0; j < td.length; j++) {
      txtValue = tr[i].getElementsByTagName("td")[j].textContent || tr[i].getElementsByTagName("td")[j].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
        break;
      } else {
        tr[i].style.display = "none";
      }
    }

  }
}
</script>
